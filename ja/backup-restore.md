# バックアップとリカバリ
**Quickstarts > 9.バックアップと復旧**

今回の学習モジュールでは、NHN Cloud環境でアプリケーションとデータを安全に保護し、復旧する方法を学習します。ブロックストレージの複製、インスタンスイメージの作成、イメージベースの作成を通じて、データ損失を防止し、迅速な復旧が可能なシステムを構築します。

![mod_info](https://kr1-api-object-storage.nhncloudservice.com/v1/AUTH_2acdfabf4efe4efc8a04c00b348110c9/cdn_origin/prod_cloud_quickstarts/module_info/%EB%B0%B1%EC%97%85%20%EB%B0%8F%20%EB%B3%B5%EA%B5%AC.png)
## 学習目標

今回の学習モジュールで学ぶ内容は以下の通りです。

* **インスタンスイメージの作成**
    * インスタンスイメージ作成機能を活用し、サーバー全体のイメージを定期的にバックアップする機能
    * 稼働中のインスタンスの状態をインスタンスイメージとして保存した後、新しいインスタンスを作成します。
* **ブロックストレージの複製と接続**
    * ブロックストレージの複製機能を活用し、既存のブロックストレージを複製した後、インスタンスと接続します。
<br></br>

![mod_diagram](https://kr1-api-object-storage.nhncloudservice.com/v1/AUTH_2acdfabf4efe4efc8a04c00b348110c9/cdn_origin/prod_cloud_quickstarts/%EB%AA%A8%EB%93%88%209.%20%EB%B0%B1%EC%97%85%20%EB%B0%8F%20%EB%B3%B5%EA%B5%AC.png)

## 始める前に

今回の学習モジュールを始める前に必要なものは以下の通りです。

* **標準のインターネットブラウザ**
    * Google Chrome、Microsoft Edge、Firefox、Safariなどの最新バージョンのブラウザがインストールされている必要があります。
    * ブラウザの設定でJavaScriptとCookieが有効になっている必要があります。
* **インターネット接続環境**
    * 安定したインターネット接続が必要で、推奨帯域幅は最低5Mbps以上です。
    * HTTPSによる安全な通信が可能であること。
* **会員アカウント**
    * 決済手段を登録したNHN Cloudアカウントが必要です。
    * NHN Cloudのホームページにログインする必要があります。

**本ガイドは、[8.モニタリング設定](https://docs.nhncloud.com/ja/quickstarts/ja/configure-monitoring/)以降の段階から始まります。**

## インスタンスイメージによるインスタンス作成とブロックストレージの接続

### ステップ1.インスタンスイメージを作成する

> 前の学習モジュールで生成した`linux-server-basic`インスタンスのイメージを生成してみます。実行中のインスタンスはイメージ生成時、整合性が保証されないので、インスタンスを停止してからイメージを生成します。

1. NHN Cloudコンソール上部のメニューから実習に使用する組織`(MyORG)`、プロジェクト(`MyPRJ)`、そして`韓国(平村)リージョンを`選択します。
2. コンソールウィンドウの左側のメニューから**Compute - Instanceを**クリックします。
3. インスタンスリストから`linux-server-basic`インスタンスをクリックして選択します。
4. インスタンスリストの上にある**---**をクリックし、**インスタンス停止を**クリックします。
5. **インスタンス停止**ウィンドウで**停止を**クリックします。
6. 成功]ウィンドウで[**OK**]をクリックします。
7. インスタンスリストの上にある[**画像作成]を**クリックします。
8. **画像作成**ウィンドウで以下の情報を設定し、[**OK**]をクリックします。
    * ファイル名:`linux-server-basic-image`
    * 削除保護:`無効`
    * **実行中のインスタンスのイメージ生成は整合性を保証しません。 進行するにはチェックボックスを選択してください。**チェックボックスを選択します。
    > [注意]
    >
    > * 実行中のインスタンスイメージの作成
    >     * 実行中のインスタンスをイメージにする場合、ファイルシステムの整合性を保証することができません。 そのため、アプリケーション駆動に問題が発生する場合もあります。可能な限り、インスタンスを停止させてからイメージを作成することをお勧めします。
9. 成功]ウィンドウで[**OK**]をクリックします。
10. コンソールウィンドウの左側のメニューから**Compute - Imageを**クリックします。
11. Image画面のイメージリストで`linux-server-basic-imageが`生成中であることを確認します。生成が完了すると、そのイメージのステータス表示などが緑色で表示されます。

### ステップ2.インスタンスイメージで新規インスタンスを作成する

> ステップ1で生成した`linux-server-basic-image`インスタンスイメージを使って`linux-server-recovery`インスタンスを新しく生成してみます。

1. コンソールウィンドウの左側のメニューから**Compute - Instanceを**クリックします。
2. **インスタンス作成を**クリックします。
3. **インテンション作成**ウィンドウで以下の情報を設定した後、**インスタンス作成を**クリックします。
    * インスタンステンプレート
        * 使用:`未使用`
    * イメージ
        * **個人イメージ イメージ**名：`linux-server-basic-image`選択
    * インスタンス情報
        * 可用性領域：`任意の可用性領域`
        * インスタンス名:`linux-server-recovery`
        * インスタンスタイプ:**インスタンスタイプ選択**> インスタンスタイプ名:`t2.c1m1`クリック後**選択**クリック
        * インスタンス数：`1`
        * キーフェア:`MyKey`
    * ルートブロックストレージ
        * ブロックストレージタイプ:`HDD`
        * ブロックストレージサイズ(GB)：`20`GB
    * ネットワーク設定：`ネットワークインターフェースの作成を`選択
    * ネットワーク
        * 利用可能なサブネット項目で`MySubnet(192.168.0.0.0/24)`リソースをクリックし、選択したサブネットとして使用します。
    * フローティングIP：**設定変更を**クリック
        * 使用:`使用`
        * 削除保護:`無効`
        * 接続するサブネット:`MySubnet (192.168.0.0/24)`
    * セキュリティグループ
        * セキュリティグループの選択：`MySG-SSH、MySG-HTTPの`選択
    * 追加ブロックストレージ: 無効 (デフォルト)
    * ユーザースクリプト: 空欄 (デフォルト)
    * 削除保護: 無効 (デフォルト)
4. インスタンス作成情報ウィンドウで**インスタンス作成を**クリックします。
5. インスタンス作成作業が行われます。数分程度でインスタンス作成が完了します。

### ステップ3.作成したインスタンスに接続する

> ステップ2で作成した`linux-server-recovery`インスタンスのフローティングIPアドレスで接続する方法を説明します。

1. コンソールウィンドウの左側のメニューから**Network - Floating IP**をクリックします。
2. フローティングIPリソースのリストのうち、接続されたデバイスが`linux-server-recoveryである`IPアドレスを**コピーして** **記録します。**
3. ウェブブラウザで新しいウィンドウを開いて`http://복사한 linux-server-recovery フローティングIPアドレスを`入力して接続を確認します。
4. ウェブページが開くことを確認します。
5. **ターミナル**または**PowerShellで**以下のコマンドを実行してリモート接続します。

```
#PowerShell
cd /(MyKey.pem ファイルがあるディレクトリ名)
    
ssh -i MyKey.pem ubuntu@コピーしたlinux-server-recoveryのフローティングIPアドレスを入力します。
```

* "Are you sure you want to continue connecting (yes/no/[fingerprint])?" というフレーズが出たら、`yesを`入力後、Enterキーを押します。
* lsb_releaseコマンドで現在接続しているLinuxのバージョンを確認します。

```
#bash
lsb_release -a
```

### ステップ4.既存のブロックストレージを複製してインスタンスに接続する

> 前の学習モジュールで生成した`MyBS`ブロックストレージを複製した後、`linux-server-recovery`インスタンスと連結して`MyBS`ブロックストレージのデータを照会してみます。

1. コンソールウィンドウの左側のメニューから**Storage - Block Storage**をクリックします。
2. **Block Storage > 管理**画面で、ブロックストレージリストから`MyBSを`選択します。
3. **ブロックストレージの複製を**クリックします。
4. **ブロックストレージの複製**画面で以下の情報を設定し、[**OK**]をクリックします。
    * 対象プロジェクト:`同一プロジェクト`
    * リージョン：韓国(平촌)
    * ブロックストレージ名:`MyBS-Duplicate`
    * ブロックストレージサイズ:`10GB`(固定)
    * ブロックストレージタイプ:`HDD`
    * 可用性領域：ブロックストレージリストで接続情報が`linux-server-recoveryの/dev/vdaである`ブロックストレージと**同じ可用性領域。**
    * **実行中のインスタンスのブロックストレージは、ファイルシステムの整合性を保証しません。 進行するには、チェックボックスを選択してください。**チェックボックスを選択します。
5. 成功]ウィンドウで[**OK**]をクリックします。
6. Block Storage**管理タブの**右側にある**複製結果**タブをクリックします。
7. 複製結果リストでステータスが**SUCCESSである**ことを確認します。
8. **管理**タブをクリックします。
9. `MyBS-Duplicateを`選択した後、上部にある**接続管理を**クリックします。
10. **ブロックストレージ接続管理**ウィンドウで以下の情報を設定した後、**接続を**クリックします。
    * インスタンスへの接続:`linux-server-recovery`
11. 成功]ウィンドウで[**OK**]をクリックします。
12. `linux-server-recovery`インスタンスにリモート接続した状態で、下記のコマンドで/mnt/vdbパスに再マウントします。

```bash
sudo mount -a
```

* 以下のコマンドで複製されたブロックストレージの値を確認します。

```bash
cat /mnt/vdb/employees.csv
```

データベースの結果値がcsvファイルで照会されることを確認します。

## 参考資料

* [イメージ](https://docs.nhncloud.com/ja/Compute/Image/ja/overview/)
* [画像生成](https://docs.nhncloud.com/ja/Compute/Instance/ja/console-guide/#_13)
* [ブロックストレージの複製](https://docs.nhncloud.com/ja/Storage/Block%20Storage/ja/console-guide/#_11)
* [Snapshot](https://en.wikipedia.org/wiki/Snapshot_(computer_storage))
* [Backup](https://en.wikipedia.org/wiki/Backup)

## 前の段階

* [8.モニタリング設定](https://docs.nhncloud.com/ja/quickstarts/ja/configure-monitoring/)

## 次のステップ

* [10.拡張性とパフォーマンスの最適化](https://docs.nhncloud.com/ja/quickstarts/ja/optimze-performance/)
